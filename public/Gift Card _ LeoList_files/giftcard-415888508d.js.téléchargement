function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function ownKeys(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach((function(e){_defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _defineProperty(t,e,n){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(t,e){if("object"!=_typeof(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}!function(){var t,e,n,a,r,o=$("#success-modal"),i=$("#transaction-history-modal"),c={fromCurrency:"",amount:""},s=new URLSearchParams(window.location.search).get("open"),d={cryptoAllow:!1,minTransaction:0,minTransactionFormatted:"",minTransactionFee:0,minTransactionFeeFormatted:"",minTransaction2:0,minTransaction2Formatted:"",suspiciousLimit:null,fiatMinimum:0,maximumTransaction:150,topUpSuccess:!1};$(window).on("load",(function t(){$.ajax({type:"GET",url:"/user/giftcard/settings",async:!0,success:function(t){d=_objectSpread(_objectSpread(_objectSpread({},d),t),{},{cryptoAllow:!0}),function(){d.cryptoAllow&&function(){if("undefined"==typeof bcprovider)return!1;var t=$(".gift-val"),e=document.body.dataset.currencyCode,n=document.body.dataset.currencySymbol,a=t?parseFloat(t.text().replace(n,"")):0;window.bcproviderInstance=new bcprovider({settingsUrl:"/cart/checkout/etherbillcurrencies",modal:!1,showExactAmount:!1,showCoinsScreen:!1,timer:null,fiatCurrency:e,fiatSign:n,statusUrl:"/user/giftcard/get-balance",onStatusPolling:function(t){t.balance>a&&(addToGiftHeader(t.balance-a,t.balance),a=t.balance)},onclick:function(t,e){var a=$("#payment-alerts-modal");if(a.length)return a.modal("show"),!1;if(!t||"BTC"!=t.code)return!0;var r=$("#bitcoin-alert"),o=$(".price.total").last().text(),i=d.fiatMinimum,c=parseFloat(o.substring(1));if(c<i){var s=Math.ceil(i-c);return $(".bitcoin-alert-amount").text(o),$(".bitcoin-add-amount").text(n+s),$("#bitcoin-add-link").attr("href","/user/giftcard/add/amount/"+s),$("#crypto-container").html(r.html()),!1}return!0}})}();d.topUpSuccess&&(o.modal(),o.on("hidden.bs.modal",(function(){setTimeout((function(){addToGiftHeader(d.topUpSuccess)}),100)})))}()},error:function(){t()}})})),$(document).ready((function(){if(e=$(".gift-card__alert--transaction-fee"),n=$(".gift-card__alert--user-limit"),a=$(".gift-card__alert--maximum-limit"),r=$(".panel-collapse"),o.on("shown.bs.modal",(function(){"#success"===location.hash&&history.replaceState(null,null," ")})),"#success"===location.hash&&o.modal(),r.on("show.bs.collapse",(function(){$(this).siblings(".gift-card-panel-heading").addClass("active")})),r.on("hide.bs.collapse",(function(){$(this).siblings(".gift-card-panel-heading").removeClass("active")})),s){var t=$(".gift-card__tab--currency");t.tab("show"),t.addClass("active")}$("#cc-add-request").on("click",(function(t){t.preventDefault(),$("#cc-add-request").hide(),$("#cc-request-added").show(),$.ajax({url:"/user/index/cc-feature-notification",dataType:"json",type:"post"})})),$("#transactions-history-btn").on("click",(function(t){t.preventDefault(),i.modal("show")})),$("#transactions-history-btn-close").on("click",(function(t){t.preventDefault(),i.modal("hide")}));var c=$("#crypto-opener"),d=$("#crypto-panel"),l=$(".js-gift-card-container"),u=l.parent(".panel-group__content"),p=$("#crypto-close"),f=function(){d.addClass("crypto-panel--displayed"),l.addClass("gift-card__tabs--hidden"),u.addClass("panel-group__content--shadowed")};c.on("click",(function(t){t.preventDefault();var e=$("#payment-alerts-modal");if(e.length)return e.modal("show"),void $("#payment-alerts-view-address").on("click",(function(){e.modal("hide").remove()}));f()})),$("#payment-alerts-view-address").on("click",f),p.on("click",(function(t){t.preventDefault(),d.removeClass("crypto-panel--displayed"),l.removeClass("gift-card__tabs--hidden"),u.removeClass("panel-group__content--shadowed")}))})),$(".btc-direct-topup").length&&($(document).on("currenciesLoaded",(function(){$(".bcprovider-spinner").show(),$(".bcprovider-app").hide(),$("#button-Bitcoin").click()})),$(document).on("btcForGiftCardLoaded",(function(){$(".bcprovider-spinner").hide(),$(".bcprovider-app").show()})),$(document).on("btcForGiftCardError",(function(){$(".bcprovider-spinner").hide()}))),$(".ltc-direct-topup").length&&($(document).on("currenciesLoaded",(function(){$(".bcprovider-spinner").show(),$(".bcprovider-app").hide(),$("#button-Litecoin").click()})),$(document).on("btcForGiftCardLoaded",(function(){$(".bcprovider-spinner").hide(),$(".bcprovider-app").show()})),$(document).on("btcForGiftCardError",(function(){$(".bcprovider-spinner").hide()})));var l=$("#transactions-container"),u=$("#transaction-details");function p(t){var e=document.body.dataset.currencySymbol;return"".concat(e).concat(t.toFixed(2))}function f(t){$.ajax({type:"GET",url:"/user/giftcard/payments",data:{page:t},async:!0,success:function(e){$("#transactions-current").text(t),$("#transactions-list").html(e)},dataType:"html"})}function m(t){var r=$(t.form||t.context),o=r.find("input[name=giftcard_cad_amount]"),i=r.find("input[name=giftcard_eur_amount]"),s=0,l=$(t),u=null;u=l.attr("name")===o.attr("name")?"cad":"eur";try{s=parseFloat(l.val())}catch(t){return}if(parseFloat(i.val())<d.minTransaction2)return i.val(d.minTransaction2),m(i);c=_objectSpread(_objectSpread({},c),{},{amount:s,fromCurrency:u}),e.hide(),n.hide(),s<d.maximumTransaction&&a.hide();var p=r.find(".topup");$.ajax({url:"/user/giftcard/converter",type:"GET",data:{from:u,amount:s},success:function(t){p.removeClass("disabled"),t.success&&("cad"==u?i.val(t.eur.toFixed(2)):o.val(t.cad.toFixed(2)));var r=parseFloat(i.val());return r<d.minTransaction2?(i.val(d.minTransaction2),m(i)):(r<d.minTransaction&&e.show(),d.suspiciousLimit&&r>parseFloat(d.suspiciousLimit)&&(p.addClass("disabled"),n.show()),!d.suspiciousLimit&&r>d.maximumTransaction?(i.val(d.maximumTransaction),a.show(),m(i)):void p.find(".top_up_val").text((r||0).toFixed(2)))}})}$("#transactions-list").on("click","a",(function(t){t.preventDefault();var e=$(this).data("order-id"),n=t.target.innerText;$("#transaction-details-order-id").html(e),u.addClass("transaction-details--displayed"),u.attr("aria-hidden","false"),l.addClass("transactions--details-open"),$.ajax({type:"POST",url:"/user/order/details",data:{id:e},async:!0,success:function(t){$("#transaction-details-content").html(t),$(".js-transaction-details-description").html(n)},dataType:"html"})})),$("#close-transaction-details").on("click",(function(){$("#transaction-details-content").html($("#transaction-details-content").data("initial-content")),u.removeClass("transaction-details--displayed"),u.attr("aria-hidden","true"),l.removeClass("transactions--details-open")})),$("#giftcard-prev").on("click",(function(){var t=$("#transactions-current"),e=parseInt(t.text());e>1&&($("#giftcard-next").addClass("enabled"),f(e-1)),1===e&&$("#giftcard-prev").addClass("text-grey").removeClass("enabled")})),$("#giftcard-next").on("click",(function(){var t=$("#transactions-current"),e=$("#transactions-total"),n=parseInt(t.text()),a=parseInt(e.text());n<a&&(f(n+1),$("#giftcard-prev").addClass("enabled")),n===a&&$("#giftcard-next").addClass("text-grey").removeClass("enabled")})),$("#giftcard-form-secret input").on("change keyup",(function(e){var n=e.keyCode||e.which;37!==n&&38!==n&&39!==n&&40!==n&&27!==n&&(t&&window.clearTimeout(t),t=setTimeout((function(){m(e.currentTarget)}),300))})),$("#wait").on("show.bs.modal",(function(){var t=$("#giftcard-form-secret").find("input[name=giftcard_eur_amount]"),e=parseFloat(t.val());e||(e=d.minTransaction2);var n=e<d.minTransaction?e+d.minTransactionFee:e;$(".gift-card__amount-to-pay").text(p(n))})),$(".topup").click((function(t){var e=$(t.currentTarget.form).find("input[name=giftcard_eur_amount]"),n=parseFloat(e.val());n||(n=d.minTransaction2);var a=n<d.minTransaction?n+d.minTransactionFee:n;return $(".gift-card__amount-to-pay").text(p(a)),$.ajax({type:"POST",url:"/user/giftcard/addamount",data:{amount:n},async:!0,success:function(t){var e=JSON.parse(t);a!==e.amount&&$(".gift-card__amount-to-pay").text(p(e.amount)),e.omega_token&&initCardinal(e.omega_token)},dataType:"html"}),$("#content_payment .btn").addClass("disabled"),!1})),$(".js-gift-card__tab").on("click",(function(t){var e=$(this).attr("href");-1===e.indexOf("#")&&(t.preventDefault(),$(this).data("same-window")?window.location=e:window.open(e))}))}();