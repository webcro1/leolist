var validation=!0;function onRegister(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=$("#registerForm");if(trackEvent({category:"Sign Up",event:"Success",GA:{label:"Click"}},["ga"]),e){var a=e.lot_number,i=e.pass_token,r=e.gen_time,n=e.captcha_output;t.find("#gee_test_lot_number").val(a),t.find("#gee_test_pass_token").val(i),t.find("#gee_test_gen_time").val(r),t.find("#gee_test_captcha_output").val(n)}t.off("submit"),t.find(":submit").prop("disabled",!1).trigger("click").prop("disabled",!0)}function onLoginRecaptcha(){onLogin()}function onLogin(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$("#loginsubmit").attr("disabled",!1);var t=document.body.dataset.lang,a="en"===t?"":"/".concat(t),i="".concat(a,"/user/login/login");trackEvent({category:"Sign Up",event:"Sign In",GA:{label:"Click"}},["ga"]);var r=decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURIComponent("disableCaptcha").replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*)))?.*$","i"),"$1")),n=decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURIComponent("disableCaptchaKey").replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*)))?.*$","i"),"$1"));"1"===r&&(i=i+"?disableCaptcha="+r+"&disableCaptchaKey="+n),$("#loginForm :input").each((function(){"checkbox"==$(this).attr("type")?$(this).prop("checked")&&(e[$(this).attr("name")]=$(this).val()):e[$(this).attr("name")]=$(this).val(),$(this).parent().find(".validate-errors").remove()})),$.post(i,e,(function(t){if("recaptcha"!==window.captcha_provider||"undefined"==typeof grecaptcha||window.disableCaptcha||window.disableLoginCaptcha||(loginRecaptchaWidget?grecaptcha.reset(loginRecaptchaWidget):grecaptcha.reset(),copyBadgeStyle()),t.errors){if(t.is_migrated_from)return changeImportSuccessHeader(t.is_migrated_from,e.login_email),!1;if(Array.isArray(t.errors)&&!t.errors.length)return $("#login-captcha-error").removeClass("hidden"),!1;for(errorKey in t.errors)"form"==errorKey?($("#loginError div.alert_description").html(t.errors[errorKey]),$("#loginError").show(300)):$('form#loginForm :input[id="'+errorKey+'"]').parent().append(getErrorHtml(t.errors[errorKey],errorKey))}else if(t.mfa){var a=$("#two-fa-modal");$("#auth-modal").modal("hide"),a.find('input[name="user"]').val(t.user),a.find('input[name="fingerprint"]').val($("#login-fingerprint").val()),a.find('input[name="mfa_token"]').val(t.mfa_token),resetTwoFaModal(t.can_send_2fa),a.modal()}else t.redirect?window.location.href=t.redirect.split("#")[0]:window.location.href="/user/manage"}),"json")}function getDatetimepicker(e){if(!e.hasClass("has-datetimepicker"))return null;var t=e.data("DateTimePicker");if(t)return t;if(e.datetimepickerParent)t=e.datetimepickerParent.data("DateTimePicker");else for(var a=e.parent();a;){if(t=a.data("DateTimePicker")){e.datetimepickerParent=a;break}a=a.parent()}return t}$((function(){function e(){try{Fingerprint2.get({fonts:{extendedJsFonts:!0},excludes:{userAgent:!0,enumerateDevices:!0}},(function(e){var t=e.map((function(e){return e.key+"="+e.value})).join("\n"),a=Fingerprint2.x64hash128(t,31);$("#login-fingerprint").val(a)}))}catch(e){}}var t,a,i,r,n,o;$("a.post-new, .js-post-new").click((function(){var e=$("#login-link");return!(e.length>0)||($("#login-url").attr("value",$(this).attr("href")),$("#register-url").attr("value",$(this).attr("href")),e.click(),!1)})),$("#login-link,#register-link").click((function(t){var a=window.location.pathname;""==$("#login-url").attr("value")&&$("#login-url").attr("value",a),""==$("#register-url").attr("value")&&$("#register-url").attr("value",a),!window.disableCaptcha&&"recaptcha"===window.captcha_provider&&$(t.currentTarget).attr("id")&&($("#registerForm, #loginForm").find('[type="submit"]').attr("disabled",!0),loadRecaptchaScript("onLoginRegisterLoad","explicit")),setTimeout(e,200)})),$("#page-login").length&&e(),$("#retrieveForm").on("submit",(function(e){e.preventDefault();var t=$(this);t.find("[name=url]").val(window.location.pathname),doValidation(null,"retrieveForm","/user/retrieve/validate",(function(){t.off("submit"),t.find(":submit").prop("disabled",!1).trigger("click").prop("disabled",!0)}))})),$("#contactPromoForm").submit((function(e){$(this).find(".validate-errors").length?e.preventDefault():$(this).find(":input[type=submit]").prop("disabled",!0)})),$("#contactUsForm :input, #contactPromoForm :input").blur((function(){var e=$(this).attr("id"),t=$(this).parents("form");doValidation(e,t.attr("id"),t.attr("data-validate-url"))})),$("#contactUsForm :input, #contactPromoForm :input").focus((function(){$(this).parent().find(".errors").remove(),$(this).removeClass("valid invalid")})),$("#contactUsForm :checkbox").change((function(){var e=$(this).attr("id"),t=$(this).parents("form");doValidation(e,t.attr("id"),t.attr("data-validate-url"))})),function(){var e=$("#registerForm"),t=$("#register-captcha-error");if(e.find(":input").on("blur",(function(){var e=$(this);e.hasClass("hide")||(e.hasClass("invalid")||doValidation($(this).attr("id"),"registerForm","/user/register/validate"))})),e.find(":input").on("focus",(function(){var e=$(this);e.parent().find(".validate-errors").remove(),e.removeClass("valid invalid");var t=e.attr("id");"register_email"===t&&trackEvent({category:"Sign Up",event:"Email",GA:{label:"Click"}},["ga"]),"register_password"===t&&trackEvent({category:"Sign Up",event:"Password",GA:{label:"Click"}},["ga"])})),window.disableCaptcha)i(onRegister);else{if("recaptcha"===window.captcha_provider)return i((function(){if("undefined"!=typeof grecaptcha)return registerRecaptchaWidget?grecaptcha.execute(registerRecaptchaWidget):grecaptcha.execute()}));if("geetest"===window.captcha_provider){if($("#page-register").length)return i((function(){geeTestRegister({onSuccess:onRegister,onError:function(){e.find("input:submit").prop("disabled",!1),t.removeClass("hidden")},onClose:function(){e.find("input:submit").prop("disabled",!1)}})}));var a=!1;return $("#register-link, .js-to-sign-up").on("click",(function(){a||"geetest"!==window.captcha_provider||(a=!0,e.find("input:submit").prop("disabled",!0),geeTestRegister({onRegister:function(){e.find("input:submit").prop("disabled",!1)},onSuccess:onRegister,onError:function(){e.find("input:submit").prop("disabled",!1),t.removeClass("hidden")},onClose:function(){e.find("input:submit").prop("disabled",!1)},initCallback:function(e){i((function(){e.showBox()}))}}))})),!1}}function i(a){e.on("submit",(function(i){i.preventDefault();var r=$(this);return t.addClass("hidden"),$("#auth-modal").length&&r.find("[name=url]").val(window.location.pathname),doValidation(null,"registerForm","/user/register/validate",(function(){e.find("input:submit").prop("disabled",!0),a()})),!1}))}}(),t=$("#loginForm"),a=$("#loginsubmit"),i=$("#login-captcha-error"),r=!1,n=function(){r=!1,a.attr("disabled",!1),i.removeClass("hidden")},o=function(){r||(r=!0,a.attr("disabled",!0),geeTestRegister({onRegister:function(){a.attr("disabled",!1)},onSuccess:onLogin,onError:n,onClose:function(){a.attr("disabled",!1)},initCallback:function(e){a.on("click",(function(){e.showBox()}))}}))},window.disableCaptcha||window.disableLoginCaptcha||"geetest"!==window.captcha_provider||!t.length||($("#login-link, .js-to-login").on("click",o),$("#page-login, #page-register").length||$(document).on("click",".js-to-login",o)),t.on("submit",(function(e){return e.preventDefault(),$("#auth-modal").length&&$(this).find("[name=url]").val(window.location.pathname),i.addClass("hidden"),a.attr("disabled",!0),$("#loginError").hide(),window.disableCaptcha||window.disableLoginCaptcha?onLogin():"recaptcha"===window.captcha_provider&&"undefined"!=typeof grecaptcha?loginRecaptchaWidget?grecaptcha.execute(loginRecaptchaWidget):grecaptcha.execute():$("#page-login").length?geeTestRegister({onSuccess:onLogin,onError:n,onClose:function(){a.attr("disabled",!1)}}):(r||n(),!1)})),t.find(":input").focus((function(e){var t=$(this);t.parent().find(".validate-errors").remove(),t.removeClass("valid invalid")}))}));var loginRecaptchaWidget=!1,registerRecaptchaWidget=!1;function onLoginRegisterLoad(){var e=$("#registerForm"),t=$("#loginForm");if(t.find('[type="submit"]').attr("disabled",!1),e.find('[type="submit"]').attr("disabled",!1),!1===registerRecaptchaWidget){var a=e.find(".g-recaptcha");registerRecaptchaWidget=enableRecaptcha(a)}if(!window.disableLoginCaptcha&&!1===loginRecaptchaWidget){var i=t.find(".g-recaptcha");loginRecaptchaWidget=enableRecaptcha(i),copyBadgeStyle()}}function copyBadgeStyle(){var e=$("#registerForm .grecaptcha-badge");$("#loginForm .grecaptcha-badge").attr("style",e.attr("style"))}function doValidation(e,t,a,i,r,n){var o=!0,c=$("form#"+t),d=c.find('[type="submit"]'),s="advanced-contact-form"===t||"question-contact-form"===t;if(s&&!c.find(".validate-errors").length&&d.removeClass("disabled"),null!==e){e.constructor!==Array&&(e=[e]);for(var l=0;l<e.length;l++){var p=c.find("#"+e[l]).get(0);!p||"BUTTON"!=p.tagName&&"submit"!=p.type||e.splice(l,1)}if(0==e.length)return!0}var g={},u=function(){var e=$(this),t=getDatetimepicker(e);if(t&&n){var a=t.date();g[e.attr("name")]=a?n(a,t):e.val()}else{var i="radio"===e.attr("type"),r="checkbox"===e.attr("type"),o=i&&e.is(":checked")||r&&e.is(":checked");g[e.attr("name")]=o||!i&&!r?e.val():""}};$("form#"+t+" :input:not(.no-validate)").each(u),$("form#"+t+" label.active :input:not(.no-validate)").each(u),$.ajax({type:"POST",url:a,data:g,async:!0,success:function(a){if(a.is_migrated_from)return changeImportSuccessHeader(a.is_migrated_from,$("#".concat(t)).find('[name="email"]').val()),!1;if(null===e){if(a)for(key in $("#".concat(t)).find(".validate-errors").remove(),a){($("#select-"+key).length?$("#select-"+key):$("#"+key)).parent().append(getErrorHtml(a[key],key)),o=!1,s&&d.addClass("disabled")}}else for(var n=0;n<e.length;n++)c.find("#"+e[n]).parent().find(".validate-errors").remove(),a&&(name=c.find("#"+e[n]).attr("name"),name=name.replace("[]",""),c.find("#"+e[n]).parent().append(getErrorHtml(a[name],e[n])),void 0!==a[name]&&(o=!1,s&&d.addClass("disabled")));o&&i?i():r&&r(a)}},"json")}function getErrorHtml(e,t){var a=0,i='<span class="validate-errors" id="errors-'+t+'">';for(errorKey in e)i+=e[errorKey]+"<br/>",a++;if(i+="</span>",a>0)return $("#"+t).addClass("invalid"),i;""!=$("#"+t).val()&&$("#"+t).addClass("valid")}