function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,o){for(var t=0;t<o.length;t++){var a=o[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,_toPropertyKey(a.key),a)}}function _createClass(e,o,t){return o&&_defineProperties(e.prototype,o),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var o=_toPrimitive(e,"string");return"symbol"==_typeof(o)?o:o+""}function _toPrimitive(e,o){if("object"!=_typeof(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,o||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(e)}var leoListMap,circleRadius=1e4,LeoListMap=function(){"use strict";function e(o,t){_classCallCheck(this,e),this.provider=o.provider||window.map_provider||"google",this.options=o,this.callback=t,this.mapIncluded=!1,this.map=null,this.circle=null,this.marker=null,this.selectedPosition=null,this.geocoder=null,this.providersData={google:{path:"https://maps.googleapis.com/maps/api/js?libraries=places"},mapbox:{path:"https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js",style:"https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css",geocoder:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.3.0/mapbox-gl-geocoder.min.js",geocoderStyle:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.3.0/mapbox-gl-geocoder.css"}},this.addMapsScript()}return _createClass(e,[{key:"addMapsScript",value:function(){var o=this,t=this.provider,a=t&&this.providersData[t];if(!a)throw new Error("provider error");if(this.mapIncluded)return!1;this.mapIncluded=!0;var r=a.path,i=a.style;"google"===t&&(window.maps_key=window.map_token),window.maps_key&&"google"===t&&(r+="&key="+window.maps_key),i&&e.loadStyle(i),e.loadScript(r,(function(e){"ok"===e&&o.callback(o.options)}))}},{key:"init",value:function(e){var o=this.options.containerId,t=e.lat||49.2631,a=e.lon||-123.106613,r=e.zoom||9;if("google"===this.provider){var i=new google.maps.LatLng(t,a);this.map=new google.maps.Map(document.getElementById(o),{center:i,mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:r})}else mapboxgl.accessToken=window.map_token,this.map=new mapboxgl.Map({container:o,style:"mapbox://styles/mapbox/streets-v11",center:[a,t],zoom:r}),this.map.addControl(new mapboxgl.NavigationControl);setTimeout((function(){window.dispatchEvent(new Event("resize"))}))}},{key:"Geocoder",value:function(){var o=this;if("google"===this.provider)this.geocoder=new google.maps.Geocoder;else{var t=this.providersData.mapbox.geocoderStyle;t&&e.loadStyle(t),e.loadScript(this.providersData.mapbox.geocoder,(function(){o.geocoder=new MapboxGeocoder({accessToken:mapboxgl.accessToken,mapboxgl:mapboxgl})}))}}},{key:"LatLng",value:function(e,o){return"google"===this.provider?new google.maps.LatLng(e,o):new mapboxgl.LngLat(o,e)}},{key:"addListener",value:function(e,o,t){"google"===this.provider?google.maps.event.addListener(e,o,t):e.on(o,t)}},{key:"mapDrawCircle",value:function(o,t){var a=this,r=this.provider;if("google"===r?this.circle&&this.circle.setMap(null):this.map.getSource("polygon")&&this.map.removeLayer("polygon").removeSource("polygon"),o)if(t||(t=circleRadius),"google"===r)this.circle=new google.maps.Circle({strokeColor:"#0000FF",strokeOpacity:0,strokeWeight:0,fillColor:"#0000FF",fillOpacity:.35,map:this.map,center:o,radius:t}),this.map.fitBounds(this.circle.getBounds());else{var i=function(){var r=e.createGeoJSONCircle(o.toArray(),t);a.map.addSource("polygon",r);var i=r.data.features[0].geometry.coordinates[0],n=i.reduce((function(e,o){return e.extend(o)}),new mapboxgl.LngLatBounds(i[0],i[0]));a.map.addLayer({id:"polygon",type:"fill",source:"polygon",layout:{},paint:{"fill-color":"#0000FF","fill-opacity":.35}}),a.map.fitBounds(n,{padding:20})};this.map.isStyleLoaded()?i():this.map.on("style.load",i)}}},{key:"mapPlaceMarker",value:function(e,o,t){var a=this,r=this.provider;if(this.marker&&("google"===r?this.marker.setMap(null):this.marker.remove()),!1!==e){var i="2b5e79";if("google"===r){new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=|"+i,new google.maps.Size(21,34));this.marker=new google.maps.Marker({position:e,animation:google.maps.Animation.BOUNCE,title:"Selected location",draggable:o,map:this.map})}else this.marker=new mapboxgl.Marker({draggable:o,color:"#".concat(i)}).setLngLat(e.toArray()).addTo(this.map);if(o&&leoListMap.addListener(this.marker,"dragend",(function(){$("#location_text").val(""),$("#clear").hide();var e="google"===r?a.marker.getPosition():a.marker.getLngLat();"function"==typeof a.setSelectedPosition?a.setSelectedPosition(e):a.mapPlaceMarker(e,!0)})),this.map.panTo(e),t)if("google"===r){new google.maps.InfoWindow({content:t}).open(this.map,this.marker)}else{var n=(new mapboxgl.Popup).setHTML(t);this.marker.setPopup(n),this.marker.togglePopup()}}}},{key:"setSelectedPosition",value:function(e){var o=this.provider;if(this.selectedPosition=e,0!=e){var t="google"===o?e.lat():e.lat,a="google"===o?e.lng():e.lng;$("#location_lat").val(t).trigger("change"),$("#location_lon").val(a).trigger("change")}else $("#location_lat").val(""),$("#location_lon").val("");this.mapPlaceMarker(e,!0),$("#location-slider").is(":visible")?this.mapDrawCircle(e):this.mapDrawCircle(!1),$("#location-line").hide(),$("#location_text").removeClass("invalid-input").prev(".validate-errors").remove(),checkAlerts()}}],[{key:"loadStyle",value:function(e){var o=document.head,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,o.appendChild(t)}},{key:"loadScript",value:function(e,o){var t=!1,a=document.createElement("script"),r=function(){t||(t=!0,o("ok"))};a.onload=r,a.onreadystatechange=function(){t||"complete"===a.readyState&&r()},a.onerror=function(){t||(t=!0,o("error"))},a.src=e,document.body.appendChild(a)}},{key:"createGeoJSONCircle",value:function(e,o,t){t||(t=64);for(var a,r,i,n=e[1],l=e[0],s=o,p=[],c=s/(111320*Math.cos(n*Math.PI/180)),g=s/110540,m=0;m<t;m++)a=m/t*(2*Math.PI),r=c*Math.cos(a),i=g*Math.sin(a),p.push([l+r,n+i]);return p.push(p[0]),{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[p]}}]}}}}])}();